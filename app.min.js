!function(){angular.module("app.products",[])}(),function(){function e(e,t,r){function n(){e.$watch(t.currentProductsState,function(e){u.errorMessage=!e}),e.$watch(r.getUser,function(e){u.user=e,u.products&&0!=u.products.length||o()}),o()}function o(){t.getProducts().then(function(e){"string"==typeof e?u.errorMessage=e:u.products=e})}var u=this;u.products=[],u.errorMessage=void 0,n()}angular.module("app.products").controller("productCtrl",e),e.$inject=["$scope","Products","User"]}(),function(){function e(e,t,r){function n(){function n(e){u=e.data;for(var n in u){var o=u[n].id,a="product_"+o;r.add(a),t.getReviews(o).then(function(e,n){return function(o){void 0===o?u=void 0:(u[e].reviews=o,u[e].reviewsNumber=o.length,u[e].averageRate=t.getAverageRate(u[e])),r.remove(n)}}(n,a))}return u}function o(e){var t;switch(e.statusText){case"UNAUTHORIZED":t="relogin";break;default:t="reload this page"}return t}var a={method:"GET",url:"https://smktesting.herokuapp.com/api/products/"};return e(a).then(n).catch(o)}function o(){return u}var u=[];return{getProducts:n,currentProductsState:o}}angular.module("app.products").factory("Products",e),e.$inject=["$http","Reviews","StateManager"]}(),function(){angular.module("app.reviews",[])}(),function(){function e(e,t){function r(r){var n=o.product.id,u=o.product.rate,a=o.product.review;e.postReview(n,u,a).then(function(e){e?(t.open("#postSuccess"),r&&(r.$setPristine(),r.$setUntouched()),o.product={}):o.error=!0})}function n(){o.error=!1}var o=this;o.product={},o.error=!1,o.postReview=r,o.resetError=n}angular.module("app.reviews").controller("postReviewCtrl",e),e.$inject=["Reviews","fancyboxService"]}(),function(){function e(e){function t(t){function r(e){return e.data}function n(){return void 0}var o={method:"GET",url:"https://smktesting.herokuapp.com/api/reviews/"+t};return e(o).then(r).catch(n)}function r(e){var t=e.reviews,r=0,n=0;for(var o in t){var u=t[o].rate;u>0&&(n+=u,r++)}var a=n/r,c=a%1==0?0:1;return a=(Math.round(2*a)/2).toFixed(c)}function n(t,r,n){function o(e){return e.data.success}function u(){return void 0}var a={method:"POST",url:"https://smktesting.herokuapp.com/api/reviews/"+t,data:{rate:r,text:n}};return e(a).then(o).catch(u)}return{getReviews:t,getAverageRate:r,postReview:n}}e.$inject=["$http"],angular.module("app.reviews").service("Reviews",e)}(),angular.module("app.shared",[]),function(){function e(e){return{restrict:"A",scope:{fancybox:"@"},link:function(t,r){r.on("click",function(){e.open(t.fancybox)})}}}e.$inject=["fancyboxService"],angular.module("app.shared").directive("fancybox",e)}(),function(){function e(){function e(e){$.fancybox.close(),$.fancybox.open({src:e.toString()},{focus:!1,keyboard:!1,touch:!1})}function t(){$.fancybox.close()}return{open:e,close:t}}angular.module("app.shared").factory("fancyboxService",e)}(),function(){function e(){function e(e){return void(e&&(e.$setPristine(),e.$setUntouched()))}return{reset:e}}angular.module("app.shared").factory("Form",e)}(),function(){function e(e){function t(t){n.push(t),e.loaded=!1}function r(t){var r=n.indexOf(t);n.splice(r,1),0===n.length&&(e.loaded=!0)}var n=[];return{add:t,remove:r}}e.$inject=["$rootScope"],angular.module("app.shared").factory("StateManager",e)}(),function(){angular.module("app.user",["ngCookies"])}(),function(){function e(e,t){function r(){e.$watch(t.getUser,function(e){o.user=e})}function n(){t.logout()}var o=this;o.logout=n,r()}e.$inject=["$scope","User"],angular.module("app.user").controller("authCtrl",e)}(),function(){function e(e,t,r,n){e.login=function(o){var u=e.user.username,a=e.user.password;u&&a&&t.login(u,a).then(function(t){t.success?n.close():e.errorMessage=t.message,e.user=r.reset(o)})},e.onInput=function(){e.errorMessage=!1}}e.$inject=["$scope","User","Form","fancyboxService"],angular.module("app.user").controller("loginCtrl",e)}(),function(){function e(e,t,r){function n(n){var o=u.user.username,a=u.user.password;o&&a&&e.register(o,a).then(function(e){e.success?r.open("#regSuccess"):u.errorMessage=e.message,u.user=t.reset(n)})}function o(){u.errorMessage=void 0}var u=this;u.user={},u.errorMessage=void 0,u.register=n,u.resetError=o}e.$inject=["User","Form","fancyboxService"],angular.module("app.user").controller("registerCtrl",e)}(),function(){function e(e,t){var r;return(r=t.getObject("user"))&&(e.defaults.headers.common.Authorization="Token "+r.token),{getUser:function(){return r},register:function(t,r){var n={method:"POST",url:"https://smktesting.herokuapp.com/api/register/",data:{username:t,password:r}};return e(n).then(function(e){return e.data})},login:function(n,o){var u={method:"POST",url:"https://smktesting.herokuapp.com/api/login/",data:{username:n,password:o}};return e(u).then(function(o){if(o.data.success){r={username:n,token:o.data.token},e.defaults.headers.common.Authorization="Token "+r.token;var u=new Date;u.setDate(u.getDate()+1),t.putObject("user",r,{expires:u})}return o.data})},logout:function(){t.remove("user"),e.defaults.headers.common.Authorization=void 0,r=void 0}}}e.$inject=["$http","$cookies"],angular.module("app.user").factory("User",e)}(),function(){angular.module("app",["app.user","app.products","app.reviews","app.shared"])}();