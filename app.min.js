!function(){angular.module("app.products",[])}(),function(){function e(e,t){t.getProducts().then(function(t){e.products=t})}e.$inject=["$scope","Products"],angular.module("app.products").controller("productCtrl",e)}(),function(){function e(e,t,r){return{getProducts:function(){var n={method:"GET",url:"https://smktesting.herokuapp.com/api/products/"};return e(n).then(function(e){var n=e.data;for(var o in n){var u=n[o].id,a="product_"+u;r.add(a),t.getReviews(u).then(function(e,o){return function(u){n[e].reviews=u,n[e].reviewsNumber=u.length,n[e].averageRate=t.getAverageRate(n[e]),r.remove(o)}}(o,a))}return n})}}}e.$inject=["$http","Reviews","StateManager"],angular.module("app.products").factory("Products",e)}(),function(){function e(e){return{getReviews:function(t){var r={method:"GET",url:"https://smktesting.herokuapp.com/api/reviews/"+t};return e(r).then(function(e){return e.data})},getAverageRate:function(e){var t=e.reviews,r=0,n=0;for(var o in t){var u=t[o].rate;u>0&&(n+=u,r++)}var a,s=n/r;return a=s%1==0?0:1,s=(Math.round(2*s)/2).toFixed(a)}}}e.$inject=["$http"],angular.module("app.products").service("Reviews",e)}(),angular.module("app.shared",[]),function(){function e(e){var t=[];return{add:function(r){t.push(r),e.loaded=!1},remove:function(r){var n=t.indexOf(r);t.splice(n,1),0===t.length&&(e.loaded=!0)}}}e.$inject=["$rootScope"],angular.module("app.shared").factory("StateManager",e)}(),function(){angular.module("app.user",["ngCookies"])}(),function(){function e(e,t){e.$watch(t.getUser,function(t){e.user=t}),e.logout=function(){t.logout()}}e.$inject=["$scope","User"],angular.module("app.user").controller("authCtrl",e)}(),function(){function e(e,t,r){e.login=function(n){var o=e.user.username,u=e.user.password;o&&u&&t.login(o,u).then(function(t){t.success?$.fancybox.close():e.errorMessage=t.message,e.user=r.reset(n)})},e.onInput=function(){e.errorMessage=!1}}e.$inject=["$scope","User","userService"],angular.module("app.user").controller("loginCtrl",e)}(),function(){function e(e,t,r){e.register=function(n){var o=e.user.username,u=e.user.password;o&&u&&t.register(o,u).then(function(t){t.success?($.fancybox.close(),$.fancybox.open({src:"#regSuccess"},{touch:!1,keyboard:!1,focus:!1})):e.errorMessage=t.message,e.user=r.reset(n)})},e.onInput=function(){e.errorMessage=!1}}e.$inject=["$scope","User","userService"],angular.module("app.user").controller("registerCtrl",e)}(),function(){function e(e,t){var r;return(r=t.getObject("user"))&&(e.defaults.headers.common.Authorization="Token "+r.token),{getUser:function(){return r},register:function(t,r){var n={method:"POST",url:"https://smktesting.herokuapp.com/api/register/",data:{username:t,password:r}};return e(n).then(function(e){return e.data})},login:function(n,o){var u={method:"POST",url:"https://smktesting.herokuapp.com/api/login/",data:{username:n,password:o}};return e(u).then(function(o){if(o.data.success){r={username:n,token:o.data.token},e.defaults.headers.common.Authorization="Token "+r.token;var u=new Date;u.setDate(u.getDate()+1),t.putObject("user",r,{expires:u})}return o.data})},logout:function(){t.remove("user"),e.defaults.headers.common.Authorization=void 0,r=void 0}}}e.$inject=["$http","$cookies"],angular.module("app.user").factory("User",e)}(),function(){function e(){return{reset:function(e){return void(e&&(e.$setPristine(),e.$setUntouched()))}}}angular.module("app.user").factory("userService",e)}(),angular.module("app",["app.user","app.products","app.shared"]);